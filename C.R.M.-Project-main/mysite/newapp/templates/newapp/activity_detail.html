{% extends 'newapp/base.html' %}

{% block title %}{{ activity.activity_id }} - Activity Details - CRM{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üìã Activity Details - {{ activity.activity_id }}</h1>
    <div class="page-header-actions">
        <a href="{% url 'newapp:activity_edit' activity.pk %}" class="btn btn-warning">‚úèÔ∏è Edit</a>
        <a href="{% url 'newapp:lead_detail' activity.lead.pk %}" class="btn btn-info">View Lead</a>
        <a href="{% url 'newapp:activity_dashboard' %}" class="btn btn-default">‚Üê Back to Dashboard</a>
    </div>
</div>

<div class="section">
    <h2>Activity Information</h2>
    <div class="detail-grid">
        <div class="detail-item">
            <label>Activity ID</label>
            <div>{{ activity.activity_id }}</div>
        </div>
        <div class="detail-item">
            <label>Activity Type</label>
            <div>
                <span class="badge badge-primary">{{ activity.get_activity_type_display }}</span>
            </div>
        </div>
        <div class="detail-item">
            <label>Date & Time</label>
            <div>{{ activity.activity_date|date:"F d, Y" }} at {{ activity.activity_time|time:"h:i A" }}</div>
        </div>
        <div class="detail-item">
            <label>Status</label>
            <div>
                <span class="badge badge-{% if activity.status == 'COMPLETED' %}success{% elif activity.status == 'SCHEDULED' %}warning{% elif activity.status == 'CANCELLED' %}danger{% else %}info{% endif %}">
                    {{ activity.get_status_display }}
                </span>
            </div>
        </div>
    </div>
</div>

<div class="section">
    <h2>Associated Lead</h2>
    <div class="detail-grid">
        <div class="detail-item">
            <label>Lead ID</label>
            <div><strong>{{ activity.lead.lead_id }}</strong></div>
        </div>
        <div class="detail-item">
            <label>Prospect</label>
            <div>
                {{ activity.lead.prospect.name }}
                {% if activity.lead.prospect.company_name %}
                <br><small>{{ activity.lead.prospect.company_name }}</small>
                {% endif %}
            </div>
        </div>
        <div class="detail-item">
            <label>Lead Status</label>
            <div>
                <span class="badge badge-info">{{ activity.lead.get_status_display }}</span>
            </div>
        </div>
        <div class="detail-item">
            <label>Assigned To</label>
            <div>{{ activity.lead.assigned_to.user.get_full_name|default:activity.lead.assigned_to.user.username }}</div>
        </div>
    </div>
</div>

<div class="section">
    <h2>Discussion Details</h2>
    <div class="detail-item">
        <label>Discussion Summary</label>
        <div class="detail-text">{{ activity.discussion_summary }}</div>
    </div>
    
    {% if activity.outcome %}
    <div class="detail-item">
        <label>Outcome</label>
        <div class="detail-text">{{ activity.outcome }}</div>
    </div>
    {% endif %}
    
    {% if activity.remarks %}
    <div class="detail-item">
        <label>Remarks</label>
        <div class="detail-text">{{ activity.remarks }}</div>
    </div>
    {% endif %}
    
    {% if activity.lead_status_update %}
    <div class="detail-item">
        <label>Lead Status Updated To</label>
        <div>
            <span class="badge badge-success">{{ activity.get_lead_status_update_display }}</span>
        </div>
    </div>
    {% endif %}
</div>

{% if activity.next_followup_date or activity.next_action_required %}
<div class="section">
    <h2>Follow-up Planning</h2>
    <div class="detail-grid">
        {% if activity.next_followup_date %}
        <div class="detail-item">
            <label>Next Follow-up Date</label>
            <div>{{ activity.next_followup_date|date:"F d, Y" }}</div>
        </div>
        {% endif %}
        
        {% if activity.next_followup_time %}
        <div class="detail-item">
            <label>Next Follow-up Time</label>
            <div>{{ activity.next_followup_time|time:"h:i A" }}</div>
        </div>
        {% endif %}
    </div>
    
    {% if activity.next_action_required %}
    <div class="detail-item">
        <label>Next Action Required</label>
        <div class="detail-text">{{ activity.next_action_required }}</div>
    </div>
    {% endif %}
</div>
{% endif %}

{% if activity.contact_person or activity.contact_number or activity.contact_email %}
<div class="section">
    <h2>Contact Information</h2>
    <div class="detail-grid">
        {% if activity.contact_person %}
        <div class="detail-item">
            <label>Contact Person</label>
            <div>{{ activity.contact_person }}</div>
        </div>
        {% endif %}
        
        {% if activity.contact_number %}
        <div class="detail-item">
            <label>Contact Number</label>
            <div>{{ activity.contact_number }}</div>
        </div>
        {% endif %}
        
        {% if activity.contact_email %}
        <div class="detail-item">
            <label>Contact Email</label>
            <div>{{ activity.contact_email }}</div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

{% if activity.attachment1 or activity.attachment2 or activity.attachment3 %}
<div class="section">
    <h2>Attachments</h2>
    <div class="detail-grid">
        {% if activity.attachment1 %}
        <div class="detail-item">
            <label>Attachment 1</label>
            <div>
                <a href="{{ activity.attachment1.url }}" target="_blank" class="btn btn-info">üìé View/Download File</a>
            </div>
        </div>
        {% endif %}
        
        {% if activity.attachment2 %}
        <div class="detail-item">
            <label>Attachment 2</label>
            <div>
                <a href="{{ activity.attachment2.url }}" target="_blank" class="btn btn-info">üìé View/Download File</a>
            </div>
        </div>
        {% endif %}
        
        {% if activity.attachment3 %}
        <div class="detail-item">
            <label>Attachment 3</label>
            <div>
                <a href="{{ activity.attachment3.url }}" target="_blank" class="btn btn-info">üìé View/Download File</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<div class="section">
    <h2>Audit Information</h2>
    <div class="detail-grid">
        <div class="detail-item">
            <label>Created By</label>
            <div>{{ activity.created_by.get_full_name|default:activity.created_by.username }}</div>
        </div>
        <div class="detail-item">
            <label>Created At</label>
            <div>{{ activity.created_at|date:"F d, Y h:i A" }}</div>
        </div>
        <div class="detail-item">
            <label>Last Updated</label>
            <div>{{ activity.updated_at|date:"F d, Y h:i A" }}</div>
        </div>
    </div>
</div>

<style>
.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-lg);
    margin-top: var(--spacing-md);
}

.detail-item {
    padding: var(--spacing-md);
    background: #f8f9fa;
    border-radius: var(--border-radius);
}

.detail-item label {
    display: block;
    font-weight: 600;
    color: var(--text-light);
    font-size: 0.875rem;
    margin-bottom: var(--spacing-xs);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.detail-item > div {
    font-size: 1rem;
    color: var(--text-dark);
}

.detail-text {
    white-space: pre-wrap;
    line-height: 1.6;
}
</style>
{% endblock %}
