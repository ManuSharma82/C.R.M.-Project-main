# Generated by Django 5.2.7 on 2025-11-06 06:47

import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('newapp', '0011_quotation_delivery_terms_master_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ServiceCall',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('service_number', models.CharField(editable=False, max_length=50, unique=True)),
                ('contact_person', models.CharField(max_length=200)),
                ('contact_phone', models.CharField(max_length=15)),
                ('contact_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('service_request_date', models.DateTimeField(default=django.utils.timezone.now)),
                ('preferred_visit_date', models.DateTimeField(blank=True, null=True)),
                ('assigned_team', models.CharField(blank=True, help_text='Region/Shift/Team', max_length=100, null=True)),
                ('service_type', models.CharField(choices=[('BREAKDOWN', 'Breakdown'), ('PREVENTIVE', 'Preventive Maintenance'), ('INSTALLATION', 'Installation'), ('CALIBRATION', 'Calibration'), ('WARRANTY', 'Warranty Claim'), ('AMC', 'AMC Service'), ('INSPECTION', 'Inspection'), ('TRAINING', 'Training')], max_length=20)),
                ('priority', models.CharField(choices=[('LOW', 'Low'), ('MEDIUM', 'Medium'), ('HIGH', 'High'), ('CRITICAL', 'Critical')], default='MEDIUM', max_length=20)),
                ('status', models.CharField(choices=[('NEW', 'New'), ('ASSIGNED', 'Assigned'), ('SCHEDULED', 'Scheduled'), ('IN_PROGRESS', 'In Progress'), ('ON_HOLD', 'On Hold'), ('COMPLETED', 'Completed'), ('CLOSED', 'Closed'), ('REJECTED', 'Rejected'), ('CANCELLED', 'Cancelled')], default='NEW', max_length=20)),
                ('mode', models.CharField(choices=[('ONSITE', 'Onsite Visit'), ('REMOTE', 'Remote Support'), ('PHONE', 'Phone Support'), ('EMAIL', 'Email Support'), ('REMOTE_ACCESS', 'Remote Access')], default='ONSITE', max_length=20)),
                ('fault_category', models.CharField(blank=True, max_length=100, null=True)),
                ('symptom', models.CharField(blank=True, max_length=200, null=True)),
                ('problem_description', models.TextField(help_text="Customer's description of the issue")),
                ('diagnosis_summary', models.TextField(blank=True, help_text="Technician's diagnosis", null=True)),
                ('resolution_summary', models.TextField(blank=True, help_text='Final resolution', null=True)),
                ('root_cause', models.TextField(blank=True, null=True)),
                ('parts_required', models.BooleanField(default=False)),
                ('warranty_status', models.CharField(choices=[('UNDER_WARRANTY', 'Under Warranty'), ('OUT_OF_WARRANTY', 'Out of Warranty'), ('AMC', 'Under AMC'), ('PAID', 'Paid Service')], default='PAID', max_length=20)),
                ('resolution_code', models.CharField(blank=True, choices=[('RESOLVED', 'Successfully Resolved'), ('PARTIAL', 'Partially Resolved'), ('PENDING_PARTS', 'Pending Spare Parts'), ('ESCALATED', 'Escalated'), ('CUSTOMER_DECLINED', 'Customer Declined'), ('NOT_RESOLVED', 'Not Resolved')], max_length=30, null=True)),
                ('time_spent_minutes', models.IntegerField(default=0, help_text='Actual service time in minutes')),
                ('service_duration', models.DurationField(blank=True, null=True)),
                ('travel_time_minutes', models.IntegerField(default=0, help_text='Travel time for onsite visits')),
                ('travel_distance_km', models.DecimalField(blank=True, decimal_places=2, default=0.0, max_digits=8, null=True)),
                ('closed_at', models.DateTimeField(blank=True, null=True)),
                ('customer_feedback_rating', models.IntegerField(blank=True, help_text='Rating 1-5', null=True)),
                ('customer_feedback_comments', models.TextField(blank=True, null=True)),
                ('follow_up_required', models.BooleanField(default=False)),
                ('follow_up_date', models.DateTimeField(blank=True, null=True)),
                ('billable', models.BooleanField(default=True)),
                ('estimated_cost', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('actual_cost', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('invoice_number', models.CharField(blank=True, max_length=50, null=True)),
                ('attachments_path', models.TextField(blank=True, help_text='Comma-separated file paths', null=True)),
                ('internal_notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('call_closed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='closed_service_calls', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_service_calls', to=settings.AUTH_USER_MODEL)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='service_calls', to='newapp.prospectcustomer')),
                ('related_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_calls', to='newapp.salesorder')),
                ('related_quotation', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_calls', to='newapp.quotation')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_service_calls', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Service Call',
                'verbose_name_plural': 'Service Calls',
                'ordering': ['-service_request_date'],
            },
        ),
        migrations.CreateModel(
            name='ServiceCallAttachment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(upload_to='service_call_attachments/%Y/%m/')),
                ('file_name', models.CharField(max_length=255)),
                ('file_type', models.CharField(choices=[('IMAGE', 'Image'), ('DOCUMENT', 'Document'), ('LOG', 'Log File'), ('REPORT', 'Report'), ('OTHER', 'Other')], max_length=20)),
                ('file_size', models.IntegerField(help_text='Size in bytes')),
                ('description', models.TextField(blank=True, null=True)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('service_call', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='newapp.servicecall')),
                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Service Call Attachment',
                'verbose_name_plural': 'Service Call Attachments',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='ServiceCallItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('item_code', models.CharField(blank=True, max_length=100, null=True)),
                ('description', models.TextField()),
                ('quantity', models.DecimalField(decimal_places=2, default=1, max_digits=10)),
                ('uom', models.CharField(default='Nos', max_length=20)),
                ('item_type', models.CharField(choices=[('SPARE_PART', 'Spare Part'), ('CONSUMABLE', 'Consumable'), ('SERVICE', 'Service Charge'), ('TRAVEL', 'Travel Charge')], default='SPARE_PART', max_length=20)),
                ('unit_price', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('tax_percentage', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('line_total', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('serial_number', models.CharField(blank=True, max_length=100, null=True)),
                ('warranty_applicable', models.BooleanField(default=False)),
                ('remarks', models.TextField(blank=True, null=True)),
                ('line_number', models.IntegerField(default=1)),
                ('item_master', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_items', to='newapp.itemmaster')),
                ('service_call', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='newapp.servicecall')),
            ],
            options={
                'verbose_name': 'Service Call Item',
                'verbose_name_plural': 'Service Call Items',
                'ordering': ['service_call', 'line_number'],
            },
        ),
        migrations.CreateModel(
            name='ServiceContract',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contract_number', models.CharField(editable=False, max_length=50, unique=True)),
                ('contract_type', models.CharField(choices=[('AMC', 'Annual Maintenance Contract'), ('CMC', 'Comprehensive Maintenance Contract'), ('WARRANTY', 'Extended Warranty'), ('ONETIME', 'One-time Service Package')], max_length=20)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField()),
                ('contract_value', models.DecimalField(decimal_places=2, max_digits=12)),
                ('service_frequency', models.CharField(blank=True, help_text='E.g., Quarterly, Monthly', max_length=100, null=True)),
                ('number_of_visits', models.IntegerField(default=0, help_text='Total visits included')),
                ('visits_completed', models.IntegerField(default=0)),
                ('coverage_details', models.TextField(blank=True, null=True)),
                ('exclusions', models.TextField(blank=True, null=True)),
                ('terms_conditions', models.TextField(blank=True, null=True)),
                ('status', models.CharField(choices=[('ACTIVE', 'Active'), ('EXPIRED', 'Expired'), ('SUSPENDED', 'Suspended'), ('CANCELLED', 'Cancelled')], default='ACTIVE', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_contracts', to=settings.AUTH_USER_MODEL)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='service_contracts', to='newapp.prospectcustomer')),
                ('related_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_contracts', to='newapp.salesorder')),
            ],
            options={
                'verbose_name': 'Service Contract',
                'verbose_name_plural': 'Service Contracts',
                'ordering': ['-start_date'],
            },
        ),
        migrations.AddField(
            model_name='servicecall',
            name='service_contract',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_calls', to='newapp.servicecontract'),
        ),
        migrations.CreateModel(
            name='Technician',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('employee_code', models.CharField(max_length=50, unique=True)),
                ('mobile', models.CharField(max_length=15)),
                ('email', models.EmailField(max_length=254)),
                ('skill_level', models.CharField(choices=[('TRAINEE', 'Trainee'), ('JUNIOR', 'Junior Technician'), ('SENIOR', 'Senior Technician'), ('SPECIALIST', 'Specialist'), ('LEAD', 'Lead Engineer')], default='JUNIOR', max_length=20)),
                ('specialization', models.CharField(blank=True, help_text='E.g., Pumps, Motors, HVAC, Electronics', max_length=200, null=True)),
                ('region', models.CharField(blank=True, max_length=100, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='technician_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Technician',
                'verbose_name_plural': 'Technicians',
                'ordering': ['user__first_name'],
            },
        ),
        migrations.AddField(
            model_name='servicecall',
            name='assigned_technician',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_calls', to='newapp.technician'),
        ),
        migrations.CreateModel(
            name='ServiceActivity',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('activity_type', models.CharField(choices=[('DIAGNOSIS', 'Diagnosis'), ('REPAIR', 'Repair'), ('REPLACEMENT', 'Part Replacement'), ('CLEANING', 'Cleaning'), ('CALIBRATION', 'Calibration'), ('TESTING', 'Testing'), ('TRAINING', 'Training'), ('CONSULTATION', 'Consultation'), ('TRAVEL', 'Travel'), ('OTHER', 'Other')], max_length=20)),
                ('activity_date', models.DateField(default=django.utils.timezone.now)),
                ('start_time', models.TimeField(blank=True, null=True)),
                ('end_time', models.TimeField(blank=True, null=True)),
                ('duration_minutes', models.IntegerField(default=0)),
                ('description', models.TextField()),
                ('remarks', models.TextField(blank=True, null=True)),
                ('is_billable', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('service_call', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activities', to='newapp.servicecall')),
                ('performed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_activities', to='newapp.technician')),
            ],
            options={
                'verbose_name': 'Service Activity',
                'verbose_name_plural': 'Service Activities',
                'ordering': ['service_call', 'activity_date', 'start_time'],
            },
        ),
        migrations.CreateModel(
            name='WarrantyRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('warranty_number', models.CharField(max_length=50, unique=True)),
                ('product_serial_number', models.CharField(blank=True, max_length=100, null=True)),
                ('product_description', models.TextField()),
                ('warranty_type', models.CharField(choices=[('MANUFACTURER', 'Manufacturer Warranty'), ('DEALER', 'Dealer Warranty'), ('EXTENDED', 'Extended Warranty')], max_length=20)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField()),
                ('coverage_details', models.TextField(blank=True, null=True)),
                ('terms_conditions', models.TextField(blank=True, null=True)),
                ('status', models.CharField(choices=[('ACTIVE', 'Active'), ('EXPIRED', 'Expired'), ('CLAIMED', 'Claimed'), ('VOID', 'Void')], default='ACTIVE', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='warranties', to='newapp.prospectcustomer')),
                ('related_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='warranties', to='newapp.salesorder')),
            ],
            options={
                'verbose_name': 'Warranty Record',
                'verbose_name_plural': 'Warranty Records',
                'ordering': ['-start_date'],
            },
        ),
        migrations.AddField(
            model_name='servicecall',
            name='warranty_record',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_calls', to='newapp.warrantyrecord'),
        ),
    ]
